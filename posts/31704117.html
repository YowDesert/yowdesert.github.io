<!DOCTYPE html><html lang="zh-TW"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>(資料庫系統) Advanced SQL | YD's 資訊學習筆記</title><meta name="author" content="YowDesert"><meta name="copyright" content="YowDesert"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="CH07 Advanced SQL（More SQL） 本章目標： 從基本 SELECT–FROM–WHERE，進階到能撰寫 實務等級的複雜 SQL 查詢。  More Complex SQL Retrieval Queries SQL 提供額外功能以支援更複雜的查詢：  Nested Queries（巢狀查詢） Joined Tables 與 Outer Joins Aggregate Func">
<meta property="og:type" content="article">
<meta property="og:title" content="(資料庫系統) Advanced SQL">
<meta property="og:url" content="https://yowdesert.github.io/posts/31704117.html">
<meta property="og:site_name" content="YD&#39;s 資訊學習筆記">
<meta property="og:description" content="CH07 Advanced SQL（More SQL） 本章目標： 從基本 SELECT–FROM–WHERE，進階到能撰寫 實務等級的複雜 SQL 查詢。  More Complex SQL Retrieval Queries SQL 提供額外功能以支援更複雜的查詢：  Nested Queries（巢狀查詢） Joined Tables 與 Outer Joins Aggregate Func">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://yowdesert.github.io/img/butterfly-icon.png">
<meta property="article:published_time" content="2025-12-14T07:00:00.000Z">
<meta property="article:modified_time" content="2025-12-14T12:56:08.785Z">
<meta property="article:author" content="YowDesert">
<meta property="article:tag" content="資料庫系統">
<meta property="article:tag" content="SQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yowdesert.github.io/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "(資料庫系統) Advanced SQL",
  "url": "https://yowdesert.github.io/posts/31704117.html",
  "image": "https://yowdesert.github.io/img/butterfly-icon.png",
  "datePublished": "2025-12-14T07:00:00.000Z",
  "dateModified": "2025-12-14T12:56:08.785Z",
  "author": [
    {
      "@type": "Person",
      "name": "YowDesert",
      "url": "https://YowDesert.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://yowdesert.github.io/posts/31704117.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="google5c543dcf16a66e3c.html"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.4/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-5975504062599634',
  enable_page_level_ads: 'true'
});</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '複製成功',
    error: '複製失敗',
    noSupport: '瀏覽器不支援'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '剛剛',
    min: '分鐘前',
    hour: '小時前',
    day: '天前',
    month: '個月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"已切換為繁體中文","cht_to_chs":"已切換為簡體中文","day_to_night":"已切換為深色模式","night_to_day":"已切換為淺色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '載入更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '(資料庫系統) Advanced SQL',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="YD's 資訊學習筆記" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">載入中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/img/backgroundPic.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">標籤</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分類</div><div class="length-num">9</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/nav_Picture.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/Top.png" alt="Logo"><span class="site-name">YD's 資訊學習筆記</span></a><a class="nav-page-title" href="/"><span class="site-name">(資料庫系統) Advanced SQL</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首頁</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">(資料庫系統) Advanced SQL</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">發表於</span><time class="post-meta-date-created" datetime="2025-12-14T07:00:00.000Z" title="發表於 2025-12-14 15:00:00">2025-12-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新於</span><time class="post-meta-date-updated" datetime="2025-12-14T12:56:08.785Z" title="更新於 2025-12-14 20:56:08">2025-12-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%B3%87%E6%96%99%E5%BA%AB%E7%B3%BB%E7%B5%B1/">資料庫系統</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%B3%87%E6%96%99%E5%BA%AB%E7%B3%BB%E7%B5%B1/SQL/">SQL</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">總字數:</span><span class="word-count">4.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">閱讀時間:</span><span>17分鐘</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">瀏覽量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1>CH07 Advanced SQL（More SQL）</h1>
<p>本章目標：<br>
從基本 SELECT–FROM–WHERE，進階到能撰寫 <strong>實務等級的複雜 SQL 查詢</strong>。</p>
<hr>
<h1>More Complex SQL Retrieval Queries</h1>
<p>SQL 提供額外功能以支援更複雜的查詢：</p>
<ul>
<li>Nested Queries（巢狀查詢）</li>
<li>Joined Tables 與 Outer Joins</li>
<li>Aggregate Functions 與 Grouping</li>
</ul>
<hr>
<h1>NULL 與 Three-Valued Logic（三值邏輯）</h1>
<h2 id="NULL-的意義">NULL 的意義</h2>
<ul>
<li>Unknown（未知）</li>
<li>Unavailable / Withheld（不可用或被隱藏）</li>
<li>Not applicable（不適用）</li>
</ul>
<h2 id="重要觀念">重要觀念</h2>
<ul>
<li>NULL 不是一個值</li>
<li>NULL ≠ NULL</li>
<li>SQL 使用 TRUE / FALSE / UNKNOWN</li>
</ul>
<h2 id="Three-Valued-Logic（三值邏輯）">Three-Valued Logic（三值邏輯）</h2>
<ul>
<li>TRUE</li>
<li>FALSE</li>
<li>UNKNOWN（通常來自 NULL）</li>
</ul>
<h3 id="AND（且）">AND（且）</h3>
<table>
<thead>
<tr>
<th>AND</th>
<th>TRUE</th>
<th>FALSE</th>
<th>UNKNOWN</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>TRUE</strong></td>
<td>TRUE</td>
<td>FALSE</td>
<td>UNKNOWN</td>
</tr>
<tr>
<td><strong>FALSE</strong></td>
<td>FALSE</td>
<td>FALSE</td>
<td>FALSE</td>
</tr>
<tr>
<td><strong>UNKNOWN</strong></td>
<td>UNKNOWN</td>
<td>FALSE</td>
<td>UNKNOWN</td>
</tr>
</tbody>
</table>
<h3 id="OR（或）">OR（或）</h3>
<table>
<thead>
<tr>
<th>OR</th>
<th>TRUE</th>
<th>FALSE</th>
<th>UNKNOWN</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>TRUE</strong></td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
</tr>
<tr>
<td><strong>FALSE</strong></td>
<td>TRUE</td>
<td>FALSE</td>
<td>UNKNOWN</td>
</tr>
<tr>
<td><strong>UNKNOWN</strong></td>
<td>TRUE</td>
<td>UNKNOWN</td>
<td>UNKNOWN</td>
</tr>
</tbody>
</table>
<h3 id="NOT（非）">NOT（非）</h3>
<table>
<thead>
<tr>
<th>Operand</th>
<th>NOT Result</th>
</tr>
</thead>
<tbody>
<tr>
<td>TRUE</td>
<td>FALSE</td>
</tr>
<tr>
<td>FALSE</td>
<td>TRUE</td>
</tr>
<tr>
<td>UNKNOWN</td>
<td>UNKNOWN</td>
</tr>
</tbody>
</table>
<hr>
<h1>檢查 NULL：IS NULL / IS NOT NULL</h1>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Fname, Lname</span><br><span class="line"><span class="keyword">FROM</span> EMPLOYEE</span><br><span class="line"><span class="keyword">WHERE</span> Super_ssn <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>
<hr>
<h1>Nested Queries（巢狀查詢）</h1>
<p>在 WHERE 中嵌入另一個完整的 SELECT 查詢。</p>
<blockquote>
<p>在一個 SQL 查詢中，<strong>再放一個完整的 SELECT-FROM-WHERE 查詢</strong><br>
關鍵用途：用「一個查詢的結果」當作「另一個查詢的條件」</p>
</blockquote>
<h2 id="什麼是-Nested-Query（巢狀查詢）">什麼是 Nested Query（巢狀查詢）</h2>
<h3 id="定義">定義</h3>
<ul>
<li><strong>Nested Query（子查詢）</strong>：<br>
一個完整的 <code>SELECT-FROM-WHERE</code> 查詢，被放在另一個查詢裡</li>
<li>外層稱為 <strong>Outer Query</strong></li>
<li>內層稱為 <strong>Nested Subquery</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ...</span><br><span class="line"><span class="keyword">FROM</span> ...</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">column</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">column</span> <span class="keyword">FROM</span> ... <span class="keyword">WHERE</span> ...);</span><br></pre></td></tr></table></figure>
<h2 id="IN-運算子（最基本、最常考）">IN 運算子（最基本、最常考）</h2>
<ul>
<li>語意
<ul>
<li>v IN V<br>
比較一個值 v 是否屬於一個集合（或 multiset）V<br>
若 v 是集合中任一元素 → 回傳 TRUE</li>
</ul>
</li>
<li>特性
<ul>
<li>子查詢回傳「一個欄位（單一 column）」<br>
可搭配 OR、AND 使用</li>
</ul>
</li>
</ul>
<h3 id="範例">範例</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> Pnumber</span><br><span class="line"><span class="keyword">FROM</span> PROJECT</span><br><span class="line"><span class="keyword">WHERE</span> Pnumber <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> Pnumber</span><br><span class="line">    <span class="keyword">FROM</span> PROJECT, DEPARTMENT, EMPLOYEE</span><br><span class="line">    <span class="keyword">WHERE</span> Dnum <span class="operator">=</span> Dnumber</span><br><span class="line">      <span class="keyword">AND</span> Mgr_ssn <span class="operator">=</span> Ssn</span><br><span class="line">      <span class="keyword">AND</span> Lname <span class="operator">=</span> <span class="string">&#x27;Smith&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">OR</span> Pnumber <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> Pno</span><br><span class="line">    <span class="keyword">FROM</span> WORKS_ON, EMPLOYEE</span><br><span class="line">    <span class="keyword">WHERE</span> Essn <span class="operator">=</span> Ssn</span><br><span class="line">      <span class="keyword">AND</span> Lname <span class="operator">=</span> <span class="string">&#x27;Smith&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>找出 Smith 當經理的專案<br>
或 Smith 有實際參與的專案</p>
</blockquote>
<h2 id="使用-Tuple（多欄位）做比較">使用 Tuple（多欄位）做比較</h2>
<ul>
<li>語法
<ul>
<li>可以把多個欄位包成一個 tuple<br>
放在比較條件中</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(column1, column2) <span class="keyword">IN</span> (subquery)</span><br></pre></td></tr></table></figure>
<h3 id="Example">Example</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> Essn</span><br><span class="line"><span class="keyword">FROM</span> WORKS_ON</span><br><span class="line"><span class="keyword">WHERE</span> (Pno, Hours) <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> Pno, Hours</span><br><span class="line">    <span class="keyword">FROM</span> WORKS_ON</span><br><span class="line">    <span class="keyword">WHERE</span> Essn <span class="operator">=</span> <span class="string">&#x27;123456789&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>找出「工作內容（專案 + 時數）<br>
和員工 123456789 完全一樣」的其他員工</p>
</blockquote>
<h2 id="IN-右邊可以直接寫常數集合">IN 右邊可以直接寫常數集合</h2>
<ul>
<li>不一定要子查詢</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> mId</span><br><span class="line"><span class="keyword">FROM</span> Browse</span><br><span class="line"><span class="keyword">WHERE</span> pNo <span class="keyword">IN</span> (<span class="string">&#x27;b30999&#x27;</span>, <span class="string">&#x27;b10234&#x27;</span>, <span class="string">&#x27;d11222&#x27;</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>IN (集合) ≈ = 某個集合中的一個</p>
</blockquote>
<h2 id="子查詢可以參考外層查詢">子查詢可以參考外層查詢</h2>
<ul>
<li>概念
<ul>
<li>子查詢可以使用「外層查詢的變數」<br>
這會導致：子查詢為外層的每一筆資料重新執行</li>
</ul>
</li>
</ul>
<h3 id="EXAMPLE">EXAMPLE</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> M.mId, B.pNo</span><br><span class="line"><span class="keyword">FROM</span> Browse <span class="keyword">AS</span> B, <span class="keyword">Member</span> <span class="keyword">AS</span> M</span><br><span class="line"><span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;王小明&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> B.mId <span class="operator">=</span> M.mId</span><br><span class="line">  <span class="keyword">AND</span> pNo <span class="keyword">IN</span> (</span><br><span class="line">      <span class="keyword">SELECT</span> pNo</span><br><span class="line">      <span class="keyword">FROM</span> Record <span class="keyword">AS</span> R, Transaction <span class="keyword">AS</span> T</span><br><span class="line">      <span class="keyword">WHERE</span> transMid <span class="operator">=</span> M.mId</span><br><span class="line">        <span class="keyword">AND</span> T.tNo <span class="operator">=</span> R.tNo</span><br><span class="line">  );</span><br></pre></td></tr></table></figure>
<blockquote>
<p>先找出「王小明」的所有 mId<br>
對 每一筆瀏覽紀錄<br>
檢查該商品是否出現在「他實際購買的商品清單」中</p>
</blockquote>
<hr>
<h1>集合比較運算子</h1>
<ul>
<li>IN</li>
<li>ANY / SOME</li>
<li>ALL</li>
</ul>
<h2 id="ANY（或-SOME）運算子">ANY（或 SOME）運算子</h2>
<h3 id="語法">語法</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">value</span> <span class="operator">=</span> <span class="keyword">ANY</span> (subquery)</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">value</span> <span class="operator">=</span> <span class="keyword">SOME</span> (subquery)</span><br></pre></td></tr></table></figure>
<h3 id="說明">說明</h3>
<ul>
<li>若 <code>value</code> 等於子查詢結果中的 <strong>任一個值</strong>，則回傳 TRUE</li>
<li><strong>等價於 <code>IN</code></strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">value</span> <span class="keyword">IN</span> (subquery)</span><br><span class="line">≡</span><br><span class="line"><span class="keyword">value</span> <span class="operator">=</span> <span class="keyword">ANY</span> (subquery)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="ALL-運算子（非常重要）">ALL 運算子（非常重要）</h2>
<h3 id="語法-2">語法</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">value</span> <span class="operator">&gt;</span> <span class="keyword">ALL</span> (subquery)</span><br></pre></td></tr></table></figure>
<h3 id="說明-2">說明</h3>
<ul>
<li><code>value</code> 必須 <strong>大於子查詢回傳的所有值</strong></li>
<li>常用於「最大 / 最小」或「比全部都大（小）」的語意</li>
</ul>
<h3 id="範例-1：薪資比較">範例 1：薪資比較</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Lname, Fname</span><br><span class="line"><span class="keyword">FROM</span> EMPLOYEE</span><br><span class="line"><span class="keyword">WHERE</span> Salary <span class="operator">&gt;</span> <span class="keyword">ALL</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> Salary</span><br><span class="line">    <span class="keyword">FROM</span> EMPLOYEE</span><br><span class="line">    <span class="keyword">WHERE</span> Dno <span class="operator">=</span> <span class="number">5</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>👉 意義：找出薪水 <strong>高於部門 5 所有員工</strong> 的人</p>
<hr>
<h3 id="範例-2：商品價格">範例 2：商品價格</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> pNo, pName</span><br><span class="line"><span class="keyword">FROM</span> Product</span><br><span class="line"><span class="keyword">WHERE</span> unitPrice <span class="operator">&gt;</span> <span class="keyword">ALL</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> unitPrice</span><br><span class="line">    <span class="keyword">FROM</span> Product</span><br><span class="line">    <span class="keyword">WHERE</span> category <span class="operator">=</span> <span class="string">&#x27;Book&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>👉 意義：找出價格 <strong>比所有書籍都貴</strong> 的商品</p>
<hr>
<h2 id="比較運算子可搭配-ANY-ALL">比較運算子可搭配 ANY / ALL</h2>
<p>可搭配的比較運算子包含：</p>
<ul>
<li><code>&gt;</code>、<code>&gt;=</code></li>
<li><code>&lt;</code>、<code>&lt;=</code></li>
<li><code>=</code>、<code>&lt;&gt;</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">value</span> <span class="operator">&gt;</span> <span class="keyword">ANY</span> (subquery)</span><br><span class="line"><span class="keyword">value</span> <span class="operator">&lt;=</span> <span class="keyword">ALL</span> (subquery)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="使用-Alias-避免模糊錯誤">使用 Alias 避免模糊錯誤</h2>
<h3 id="為什麼需要-Alias？">為什麼需要 Alias？</h3>
<ul>
<li>不同資料表可能有 <strong>相同欄位名稱</strong></li>
<li>若不使用 alias，SQL 會產生 <strong>語意不明或錯誤</strong></li>
</ul>
<h3 id="範例（Query-16）">範例（Query 16）</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> E.Fname, E.Lname</span><br><span class="line"><span class="keyword">FROM</span> EMPLOYEE <span class="keyword">AS</span> E</span><br><span class="line"><span class="keyword">WHERE</span> E.Ssn <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> Essn</span><br><span class="line">    <span class="keyword">FROM</span> DEPENDENT <span class="keyword">AS</span> D</span><br><span class="line">    <span class="keyword">WHERE</span> E.Fname <span class="operator">=</span> D.Dependent_name</span><br><span class="line">      <span class="keyword">AND</span> E.Sex <span class="operator">=</span> D.Sex</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>👉 意義：</p>
<ul>
<li>找出「有家屬」</li>
<li>且家屬 <strong>名字與性別都與員工相同</strong> 的員工</li>
</ul>
<hr>
<h1>Correlated Nested Queries（相關巢狀查詢）</h1>
<h2 id="定義-2">定義</h2>
<ul>
<li>子查詢 <strong>會參考外層查詢的欄位</strong></li>
<li>子查詢會對外層的 <strong>每一筆資料重新執行一次</strong></li>
</ul>
<h2 id="特性">特性</h2>
<ul>
<li>表達能力強</li>
<li>但效能可能較差（若 DBMS 未最佳化）</li>
</ul>
<h2 id="改寫為單一查詢（JOIN）">改寫為單一查詢（JOIN）</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> E.Fname, E.Lname</span><br><span class="line"><span class="keyword">FROM</span> EMPLOYEE <span class="keyword">AS</span> E, DEPENDENT <span class="keyword">AS</span> D</span><br><span class="line"><span class="keyword">WHERE</span> E.Ssn <span class="operator">=</span> D.Essn</span><br><span class="line">  <span class="keyword">AND</span> E.Sex <span class="operator">=</span> D.Sex</span><br><span class="line">  <span class="keyword">AND</span> E.Fname <span class="operator">=</span> D.Dependent_name;</span><br></pre></td></tr></table></figure>
<p>👉 與前一頁巢狀查詢 <strong>語意完全相同</strong><br>
👉 DBMS 內部通常會做這類最佳化</p>
<hr>
<h1>EXISTS 函數</h1>
<h2 id="語法-3">語法</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXISTS</span> (subquery)</span><br></pre></td></tr></table></figure>
<h2 id="說明-3">說明</h2>
<ul>
<li>檢查子查詢 <strong>是否回傳至少一筆資料</strong></li>
<li>回傳值為 <strong>TRUE / FALSE</strong></li>
<li>常與 <strong>correlated nested query</strong> 搭配使用</li>
</ul>
<h3 id="範例：找出有購買指定商品的會員">範例：找出有購買指定商品的會員</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> mId, name</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Member</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span> Product, Record, Transaction</span><br><span class="line">    <span class="keyword">WHERE</span> pName <span class="operator">=</span> <span class="string">&#x27;系統分析理論與實務&#x27;</span></span><br><span class="line">      <span class="keyword">AND</span> Product.pNo <span class="operator">=</span> Record.pNo</span><br><span class="line">      <span class="keyword">AND</span> Record.tNo <span class="operator">=</span> Transaction.tNo</span><br><span class="line">      <span class="keyword">AND</span> mId <span class="operator">=</span> transMid</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>👉 子查詢中的 <code>mId</code> 來自外層 Member（相關子查詢）</p>
<hr>
<h2 id="EXISTS-EXISTS（複合條件）">EXISTS + EXISTS（複合條件）</h2>
<h3 id="範例：找出「至少有一位家屬的主管」">範例：找出「至少有一位家屬的主管」</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Fname, Lname</span><br><span class="line"><span class="keyword">FROM</span> Employee</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span> DEPENDENT</span><br><span class="line">    <span class="keyword">WHERE</span> Ssn <span class="operator">=</span> Essn</span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span> Department</span><br><span class="line">    <span class="keyword">WHERE</span> Ssn <span class="operator">=</span> Mgr_ssn</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>👉 同時滿足：</p>
<ul>
<li>是主管</li>
<li>且至少有一位家屬</li>
</ul>
<hr>
<h1>NOT EXISTS</h1>
<h2 id="語法-4">語法</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (subquery)</span><br></pre></td></tr></table></figure>
<h2 id="說明-4">說明</h2>
<ul>
<li>子查詢 <strong>完全沒有回傳資料</strong> 時為 TRUE</li>
</ul>
<hr>
<h3 id="範例：找出不是由購物車產生的交易">範例：找出不是由購物車產生的交易</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tNo, transMid</span><br><span class="line"><span class="keyword">FROM</span> Transaction <span class="keyword">AS</span> T</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span> Cart</span><br><span class="line">    <span class="keyword">WHERE</span> tNo <span class="operator">=</span> T.tNo</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>👉 意義：找出 <strong>非由購物車而來的交易紀錄</strong></p>
<hr>
<h2 id="重點整理">重點整理</h2>
<ul>
<li><code>IN</code> ≡ <code>= ANY</code></li>
<li><code>&gt; ALL</code>：比所有值都大</li>
<li>ANY / ALL 可搭配各種比較運算子</li>
<li>EXISTS 回傳 TRUE / FALSE（不看內容，只看有沒有資料）</li>
<li>Correlated nested query：對外層每筆資料執行一次</li>
<li>EXISTS / NOT EXISTS 非常適合表示「存在 / 不存在」</li>
</ul>
<hr>
<h1>JOINed Tables</h1>
<h2 id="核心觀念：JOIN-是在-FROM-先做、WHERE-再過濾">核心觀念：JOIN 是在 FROM 先做、WHERE 再過濾</h2>
<p>SQL 的邏輯執行順序（觀念上）：</p>
<ol>
<li><code>FROM</code>（含 JOIN / ON）先形成一張「中間結果表」</li>
<li><code>WHERE</code> 再把不符合條件的列刪掉</li>
<li><code>SELECT</code> 決定輸出欄位</li>
<li><code>DISTINCT / GROUP BY / HAVING / ORDER BY</code> …</li>
</ol>
<p>✅ 這會直接影響 <strong>OUTER JOIN</strong>：</p>
<ul>
<li><code>ON</code>：決定「怎麼配對」以及「配不到要不要補 NULL」</li>
<li><code>WHERE</code>：會把結果再刪掉，可能把補 NULL 的列刪光 → <strong>OUTER JOIN 失效</strong></li>
</ul>
<hr>
<h2 id="Joined-table（在-FROM-直接指定-JOIN-出來的表）">Joined table（在 FROM 直接指定 JOIN 出來的表）</h2>
<h3 id="定義-3">定義</h3>
<p><strong>Joined table</strong>：讓你在 <code>FROM</code> 子句直接寫出 join 的結果表。</p>
<h3 id="範例-2">範例</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Fname, Lname, Address</span><br><span class="line"><span class="keyword">FROM</span> (EMPLOYEE <span class="keyword">JOIN</span> DEPARTMENT <span class="keyword">ON</span> Dno <span class="operator">=</span> Dnumber)</span><br><span class="line"><span class="keyword">WHERE</span> Dname <span class="operator">=</span> <span class="string">&#x27;Research&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>先把 EMPLOYEE 與 DEPARTMENT 依 <code>Dno = Dnumber</code> 配對</li>
<li>再挑出部門名稱為 Research 的員工</li>
</ul>
<blockquote>
<p>小結：<code>JOIN</code> 也常被稱為 <code>INNER JOIN</code>（預設就是內連接）。</p>
</blockquote>
<hr>
<h2 id="JOIN-的種類總覽">JOIN 的種類總覽</h2>
<h3 id="NATURAL-JOIN">NATURAL JOIN</h3>
<ul>
<li><strong>不寫 ON</strong> 的 join</li>
<li>系統會自動用「兩張表中同名欄位」做等值連接（EQUIJOIN）</li>
<li>風險：同名欄位一多、或命名不一致，很容易 join 錯</li>
</ul>
<h3 id="OUTER-JOIN（LEFT-RIGHT-FULL）">OUTER JOIN（LEFT / RIGHT / FULL）</h3>
<ul>
<li>用來保留「配不到」的資料列</li>
<li>配不到的一側欄位會 <strong>補 NULL</strong></li>
</ul>
<hr>
<h2 id="NATURAL-JOIN（自然連接）">NATURAL JOIN（自然連接）</h2>
<h3 id="概念">概念</h3>
<p>若兩張表 R 與 S 有同名欄位（例如都叫 <code>Dno</code>），則：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">R <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> S</span><br></pre></td></tr></table></figure>
<p>等價於：</p>
<ul>
<li>對所有同名欄位做 <code>R.col = S.col</code> 的等值連接</li>
<li>並且輸出時同名欄位只留一份</li>
</ul>
<h3 id="為了-NATURAL-JOIN，常需要先「改欄位名」">為了 NATURAL JOIN，常需要先「改欄位名」</h3>
<p>EXAMPLE：DEPARTMENT 原本是 <code>Dnumber</code>，EMPLOYEE 是 <code>Dno</code><br>
→ 名字不同就 NATURAL JOIN 不起來，所以先把 DEPARTMENT 的 Dnumber 改名為 Dno：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Fname, Lname, Address</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">  EMPLOYEE <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span></span><br><span class="line">  (DEPARTMENT <span class="keyword">AS</span> DEPT (Dname, Dno, Mssn, Msdate))</span><br><span class="line">)</span><br><span class="line"><span class="keyword">WHERE</span> Dname <span class="operator">=</span> <span class="string">&#x27;Research&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>📌 解釋：</p>
<ul>
<li><code>DEPARTMENT AS DEPT (Dname, Dno, Mssn, Msdate)</code> 這段是在 <strong>重新命名欄位</strong></li>
<li>讓 <code>EMPLOYEE.Dno</code> 能和 <code>DEPT.Dno</code> 同名</li>
<li>因此 NATURAL JOIN 的隱含條件就是：<code>EMPLOYEE.Dno = DEPT.Dno</code></li>
</ul>
<blockquote>
<p>✅ 結論：NATURAL JOIN 的本質仍是 <strong>等值連接</strong>，只是條件隱藏了。</p>
</blockquote>
<hr>
<h2 id="INNER-JOIN-vs-OUTER-JOIN">INNER JOIN vs OUTER JOIN</h2>
<h3 id="INNER-JOIN（內連接）">INNER JOIN（內連接）</h3>
<ul>
<li>只有「兩邊都配得到」的列才會出現在結果中</li>
</ul>
<h3 id="LEFT-OUTER-JOIN（左外連接）">LEFT OUTER JOIN（左外連接）</h3>
<ul>
<li><strong>左表每一列一定要出現</strong></li>
<li>如果右表配不到 → 右表欄位補 NULL</li>
</ul>
<h3 id="RIGHT-OUTER-JOIN（右外連接）">RIGHT OUTER JOIN（右外連接）</h3>
<ul>
<li><strong>右表每一列一定要出現</strong></li>
<li>如果左表配不到 → 左表欄位補 NULL</li>
</ul>
<blockquote>
<p>FULL OUTER JOIN：左右兩邊都保留（有些 DB 不支援）</p>
</blockquote>
<hr>
<h2 id="LEFT-OUTER-JOIN-範例（員工與主管）">LEFT OUTER JOIN 範例（員工與主管）</h2>
<h3 id="需求">需求</h3>
<p>列出每位員工與他的主管（如果沒有主管，也要列出員工）。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> E.Lname <span class="keyword">AS</span> Employee_Name,</span><br><span class="line">       S.Lname <span class="keyword">AS</span> Supervisor_Name</span><br><span class="line"><span class="keyword">FROM</span> (EMPLOYEE <span class="keyword">AS</span> E <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> EMPLOYEE <span class="keyword">AS</span> S</span><br><span class="line">      <span class="keyword">ON</span> E.Super_ssn <span class="operator">=</span> S.Ssn);</span><br></pre></td></tr></table></figure>
<p>📌 解讀：</p>
<ul>
<li>這是「自我連接」（EMPLOYEE 跟自己 JOIN）</li>
<li>主管資訊在同一張表，用 <code>Super_ssn</code> 指到主管的 <code>Ssn</code></li>
<li>若某員工 <code>Super_ssn</code> 是 NULL 或找不到對應主管<br>
→ 仍保留員工列，主管欄位補 NULL</li>
</ul>
<h3 id="舊式語法（了解即可）">舊式語法（了解即可）</h3>
<p>有些系統曾用 <code>+=</code>、<code>=+</code>、<code>+=+</code> 表示 outer join。<br>
現在考試多以標準 SQL 的 <code>LEFT/RIGHT/FULL OUTER JOIN</code> 為主。</p>
<hr>
<h2 id="Multiway-JOIN（多表-JOIN）">Multiway JOIN（多表 JOIN）</h2>
<h3 id="概念-2">概念</h3>
<p>多張表 JOIN 時，可以把 JOIN <strong>巢狀包起來</strong>（nest join specifications）。</p>
<h3 id="範例（Q2A）">範例（Q2A）</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Pnumber, Dnum, Lname, Address, Bdate</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">  (PROJECT <span class="keyword">JOIN</span> DEPARTMENT <span class="keyword">ON</span> Dnum <span class="operator">=</span> Dnumber)</span><br><span class="line">  <span class="keyword">JOIN</span> EMPLOYEE <span class="keyword">ON</span> Mgr_ssn <span class="operator">=</span> Ssn</span><br><span class="line">)</span><br><span class="line"><span class="keyword">WHERE</span> Plocation <span class="operator">=</span> <span class="string">&#x27;Stafford&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>📌 解讀流程：</p>
<ol>
<li><code>PROJECT</code> 先 JOIN <code>DEPARTMENT</code>（專案屬於哪個部門）</li>
<li>再把上一步結果 JOIN <code>EMPLOYEE</code>（該部門的經理是誰）</li>
<li>最後 WHERE 篩選專案地點 <code>Stafford</code></li>
</ol>
<hr>
<h2 id="OUTER-JOIN-的「超級陷阱」：條件放-WHERE-會讓-OUTER-JOIN-失效">OUTER JOIN 的「超級陷阱」：條件放 WHERE 會讓 OUTER JOIN 失效</h2>
<h3 id="題目需求">題目需求</h3>
<p>「列出每一位會員的會員編號、姓名，以及 <strong>2005 年</strong>所瀏覽的商品編號（如果有的話）」</p>
<p>也就是：</p>
<ul>
<li><strong>每個會員都要列出</strong>（所以要 LEFT OUTER JOIN）</li>
<li>但瀏覽紀錄只要 2005 年的</li>
</ul>
<hr>
<h3 id="錯誤寫法（WRONG）">錯誤寫法（WRONG）</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> M.mId, name, pNo</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Member</span> <span class="keyword">AS</span> M <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> Browse <span class="keyword">AS</span> B</span><br><span class="line">     <span class="keyword">ON</span> M.mId <span class="operator">=</span> B.mId</span><br><span class="line"><span class="keyword">WHERE</span> to_char(browseTime, <span class="string">&#x27;yyyy&#x27;</span>) <span class="operator">=</span> <span class="string">&#x27;2005&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>❌ 為什麼錯？</p>
<ul>
<li>LEFT OUTER JOIN 先把「沒有瀏覽紀錄」的會員補了一列（B.* = NULL）</li>
<li>但 <code>WHERE to_char(browseTime, 'yyyy') = '2005'</code><br>
對於 <code>browseTime = NULL</code> 的列，條件結果會是 UNKNOWN → 被 WHERE 過濾掉</li>
<li>結果：<strong>沒有 2005 瀏覽紀錄的會員整個不見</strong><br>
➡️ LEFT OUTER JOIN 的「保留所有會員」效果被破壞</li>
</ul>
<h3 id="正確寫法（把條件放-ON）">正確寫法（把條件放 ON）</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> M.mId, name, pNo</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Member</span> <span class="keyword">AS</span> M <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> Browse <span class="keyword">AS</span> B</span><br><span class="line"><span class="keyword">ON</span> (</span><br><span class="line">  M.mId <span class="operator">=</span> B.mId</span><br><span class="line">  <span class="keyword">AND</span> to_char(browseTime, <span class="string">&#x27;yyyy&#x27;</span>) <span class="operator">=</span> <span class="string">&#x27;2005&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>✅ 為什麼這樣對？</p>
<ul>
<li><code>ON</code> 的條件是「配對規則」：只把 2005 的瀏覽紀錄拿來配</li>
<li>沒有 2005 瀏覽紀錄的會員：仍會保留（右表補 NULL）</li>
<li>完全符合題意：「如果有的話」</li>
</ul>
<hr>
<h2 id="什麼時候放-ON？什麼時候放-WHERE？">什麼時候放 ON？什麼時候放 WHERE？</h2>
<p>✅ <strong>放 ON（配對條件）</strong>：</p>
<ul>
<li>你要保留 outer join 的「配不到也要留」效果</li>
<li>右表的篩選條件（例如年份、狀態）又不能把左表刪掉</li>
</ul>
<p>✅ <strong>放 WHERE（結果過濾）</strong>：</p>
<ul>
<li>你就是要把不符合條件的列刪掉（不管 outer join）</li>
<li>或你在 INNER JOIN 情境下過濾</li>
</ul>
<hr>
<h2 id="JOIN整理">JOIN整理</h2>
<ul>
<li><code>JOIN</code> 預設是 <code>INNER JOIN</code></li>
<li><code>NATURAL JOIN</code>：用同名欄位自動等值連接（不寫 ON）</li>
<li><code>LEFT OUTER JOIN</code>：左表全保留；右表配不到補 NULL</li>
<li><code>RIGHT OUTER JOIN</code>：右表全保留；左表配不到補 NULL</li>
<li>多表 JOIN：可以巢狀寫 <code>(... JOIN ...) JOIN ...</code></li>
<li>OUTER JOIN 篩選條件：
<ul>
<li>放 <code>WHERE</code> 可能讓 OUTER JOIN 變成 INNER JOIN</li>
<li>放 <code>ON</code> 才能保留「配不到也要留」</li>
</ul>
</li>
</ul>
<hr>
<h1>Aggregate Functions &amp; GROUP BY / HAVING</h1>
<h2 id="Aggregate-Functions（彙總函數）">Aggregate Functions（彙總函數）</h2>
<p>用來把多筆 tuple 的資訊彙總成「單筆結果」或「每組一筆結果」。</p>
<p>常見內建函數：</p>
<ul>
<li><code>COUNT</code>, <code>SUM</code>, <code>MAX</code>, <code>MIN</code>, <code>AVG</code></li>
</ul>
<h3 id="NULL-與-aggregate">NULL 與 aggregate</h3>
<ul>
<li>對欄位做 <code>SUM/MAX/MIN/AVG</code> 時：<strong>NULL 會被忽略（discarded）</strong></li>
<li><code>COUNT(*)</code>：算列數（包含該列某些欄位為 NULL 也會算）</li>
<li><code>COUNT(col)</code>：只算 <code>col</code> <strong>不是 NULL</strong> 的列</li>
</ul>
<hr>
<h2 id="Aggregation-結果改欄位名、取別名（AS）">Aggregation 結果改欄位名、取別名（AS）</h2>
<h3 id=""></h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(Salary), <span class="built_in">MAX</span>(Salary), <span class="built_in">MIN</span>(Salary), <span class="built_in">AVG</span>(Salary)</span><br><span class="line"><span class="keyword">FROM</span> EMPLOYEE;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  <span class="built_in">SUM</span>(Salary) <span class="keyword">AS</span> Total_Sal,</span><br><span class="line">  <span class="built_in">MAX</span>(Salary) <span class="keyword">AS</span> Highest_Sal,</span><br><span class="line">  <span class="built_in">MIN</span>(Salary) <span class="keyword">AS</span> Lowest_Sal,</span><br><span class="line">  <span class="built_in">AVG</span>(Salary) <span class="keyword">AS</span> Average_Sal</span><br><span class="line"><span class="keyword">FROM</span> EMPLOYEE;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Aggregation-WHERE（先篩選，再彙總）">Aggregation + WHERE（先篩選，再彙總）</h2>
<h3 id="範例-3">範例</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(Salary), <span class="built_in">MAX</span>(Salary), <span class="built_in">MIN</span>(Salary), <span class="built_in">AVG</span>(Salary)</span><br><span class="line"><span class="keyword">FROM</span> (EMPLOYEE <span class="keyword">JOIN</span> DEPARTMENT <span class="keyword">ON</span> Dno <span class="operator">=</span> Dnumber)</span><br><span class="line"><span class="keyword">WHERE</span> Dname <span class="operator">=</span> <span class="string">&#x27;Research&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="COUNT-範例">COUNT 範例</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 全公司員工數</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> EMPLOYEE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Research 部門員工數</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> EMPLOYEE, DEPARTMENT</span><br><span class="line"><span class="keyword">WHERE</span> Dno <span class="operator">=</span> Dnumber <span class="keyword">AND</span> Dname <span class="operator">=</span> <span class="string">&#x27;Research&#x27;</span>;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="SOME-ALL-也可當「布林集合函數」">SOME / ALL 也可當「布林集合函數」</h2>
<p>把一串布林值（TRUE/FALSE/UNKNOWN）當集合看：</p>
<ul>
<li><code>SOME</code>：只要<strong>至少一個 TRUE</strong> → TRUE（像 OR）</li>
<li><code>ALL</code>：必須<strong>全部 TRUE</strong> → TRUE（像 AND）</li>
</ul>
<blockquote>
<p>這裡是「函數」語意，不是前面比較運算子的 <code>= ANY</code>, <code>&gt; ALL</code> 那種用法。</p>
</blockquote>
<hr>
<h2 id="GROUP-BY（分組）">GROUP BY（分組）</h2>
<p>把資料依某些欄位分成多組，然後 <strong>每組各自做 aggregate</strong>。</p>
<h3 id="規則（必背）">規則（必背）</h3>
<ul>
<li><code>SELECT</code> 中若同時出現「一般欄位」與「aggregate」：
<ul>
<li>一般欄位必須出現在 <code>GROUP BY</code></li>
</ul>
</li>
</ul>
<h3 id="範例（Q24：每個部門的員工數與平均薪資）">範例（Q24：每個部門的員工數與平均薪資）</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Dno, <span class="built_in">COUNT</span>(<span class="operator">*</span>), <span class="built_in">AVG</span>(Salary)</span><br><span class="line"><span class="keyword">FROM</span> EMPLOYEE</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> Dno;</span><br></pre></td></tr></table></figure>
<h3 id="NULL-分組">NULL 分組</h3>
<ul>
<li>分組欄位若可能為 NULL → <strong>NULL 會形成獨立的一組</strong></li>
</ul>
<h2 id="GROUP-BY-套在-JOIN-結果上">GROUP BY 套在 JOIN 結果上</h2>
<h3 id="範例（Q25：每個專案有多少員工參與）">範例（Q25：每個專案有多少員工參與）</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Pnumber, Pname, <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> PROJECT, WORKS_ON</span><br><span class="line"><span class="keyword">WHERE</span> Pnumber <span class="operator">=</span> Pno</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> Pnumber, Pname;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="HAVING（篩選「整組」）">HAVING（篩選「整組」）</h2>
<ul>
<li><code>WHERE</code>：逐列（tuple by tuple）篩選</li>
<li><code>HAVING</code>：逐組（group）篩選（常搭配 aggregate 條件）</li>
</ul>
<h3 id="範例（Q26：參與人數-2-的專案）">範例（Q26：參與人數 &gt; 2 的專案）</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Pnumber, Pname, <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> PROJECT, WORKS_ON</span><br><span class="line"><span class="keyword">WHERE</span> Pnumber <span class="operator">=</span> Pno</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> Pnumber, Pname</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="WHERE-HAVING-的常見錯誤與正確寫法">WHERE + HAVING 的常見錯誤與正確寫法</h2>
<p>需求：</p>
<blockquote>
<p>各部門中「薪資 &gt; 40000 的員工數」，但只統計「部門總員工數 &gt; 5」的部門。</p>
</blockquote>
<h3 id="錯誤（會把部門總人數也限制成薪資-40000-的人數）">錯誤（會把部門總人數也限制成薪資 &gt; 40000 的人數）</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Dno, <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> EMPLOYEE</span><br><span class="line"><span class="keyword">WHERE</span> Salary <span class="operator">&gt;</span> <span class="number">40000</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> Dno</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>
<h3 id="正確（先選出「總員工數-5」的部門，再統計該部門的高薪員工數）">正確（先選出「總員工數 &gt; 5」的部門，再統計該部門的高薪員工數）</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Dno, <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> EMPLOYEE</span><br><span class="line"><span class="keyword">WHERE</span> Salary <span class="operator">&gt;</span> <span class="number">40000</span></span><br><span class="line">  <span class="keyword">AND</span> Dno <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> Dno</span><br><span class="line">    <span class="keyword">FROM</span> EMPLOYEE</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> Dno</span><br><span class="line">    <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">5</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> Dno;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="快速對照">快速對照</h2>
<ul>
<li><code>WHERE</code>：篩「列」</li>
<li><code>GROUP BY</code>：分「組」</li>
<li><code>HAVING</code>：篩「組」</li>
<li><code>COUNT(*)</code>：算列數</li>
<li><code>COUNT(col)</code>：算 col 非 NULL 的列數</li>
</ul>
<hr>
<h1>WITH Clause（CTE</h1>
<ul>
<li>定義只在單一查詢中使用的暫時表（temporary view）</li>
<li>用來提升可讀性，把複雜查詢拆成步驟</li>
<li>功能等同子查詢，但更好讀</li>
</ul>
<h2 id="WITH-範例（改寫子查詢">WITH 範例（改寫子查詢</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> BIGDEPTS(Dno) <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> Dno</span><br><span class="line">  <span class="keyword">FROM</span> EMPLOYEE</span><br><span class="line">  <span class="keyword">GROUP</span> <span class="keyword">BY</span> Dno</span><br><span class="line">  <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">5</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> Dno, <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> EMPLOYEE</span><br><span class="line"><span class="keyword">WHERE</span> Salary <span class="operator">&gt;</span> <span class="number">40000</span> <span class="keyword">AND</span> Dno <span class="keyword">IN</span> BIGDEPTS</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> Dno;</span><br></pre></td></tr></table></figure>
<ul>
<li>與 <code>IN (SELECT ... HAVING ...)</code> 結果相同</li>
</ul>
<h2 id="CASE（條件表達式）">CASE（條件表達式）</h2>
<ul>
<li>SQL 的 if–else</li>
<li>可用於 SELECT / UPDATE / INSERT</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CASE</span></span><br><span class="line">  <span class="keyword">WHEN</span> <span class="keyword">condition</span> <span class="keyword">THEN</span> <span class="keyword">value</span></span><br><span class="line">  <span class="keyword">ELSE</span> <span class="keyword">value</span></span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>
<h2 id="Recursive-Queries-概念">Recursive Queries 概念</h2>
<ul>
<li>用於階層式資料（如員工與主管）</li>
<li>同一資料表重複引用自己</li>
</ul>
<h2 id="Recursive-CTE-範例">Recursive CTE 範例</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> <span class="keyword">RECURSIVE</span> SUP_EMP(SupSsn, EmpSsn) <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> SupervisorSsn, Ssn <span class="keyword">FROM</span> EMPLOYEE</span><br><span class="line">  <span class="keyword">UNION</span></span><br><span class="line">  <span class="keyword">SELECT</span> E.Ssn, S.SupSsn</span><br><span class="line">  <span class="keyword">FROM</span> EMPLOYEE E, SUP_EMP S</span><br><span class="line">  <span class="keyword">WHERE</span> E.SupervisorSsn <span class="operator">=</span> S.EmpSsn</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> SUP_EMP;</span><br></pre></td></tr></table></figure>
<ul>
<li>Base case + Recursive step</li>
<li>重複直到無新資料</li>
</ul>
<h2 id="SQL-查詢完整結構">SQL 查詢完整結構</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT → FROM → WHERE → GROUP BY → HAVING → ORDER BY</span><br></pre></td></tr></table></figure>
<ul>
<li>WHERE：逐列</li>
<li>HAVING：逐組</li>
</ul>
<h2 id="7-ASSERTION（語意約束">7. ASSERTION（語意約束</h2>
<ul>
<li>定義超出 PK / FK / CHECK 的限制</li>
<li>多數 DBMS 不支援，考試知道即可</li>
</ul>
<h2 id="8-TRIGGER">8. TRIGGER</h2>
<ul>
<li>Event + Condition + Action</li>
<li>事件發生時自動執行</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> ...</span><br><span class="line">AFTER <span class="keyword">INSERT</span> <span class="keyword">ON</span> ...</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">WHEN</span> (<span class="keyword">condition</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="13-Recursive-Queries">13. Recursive Queries</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> <span class="keyword">RECURSIVE</span> SUP_EMP <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> SupervisorSsn, Ssn</span><br><span class="line">  <span class="keyword">FROM</span> EMPLOYEE</span><br><span class="line">  <span class="keyword">UNION</span></span><br><span class="line">  <span class="keyword">SELECT</span> E.SupervisorSsn, S.Ssn</span><br><span class="line">  <span class="keyword">FROM</span> EMPLOYEE E, SUP_EMP S</span><br><span class="line">  <span class="keyword">WHERE</span> E.SupervisorSsn <span class="operator">=</span> S.Ssn</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> SUP_EMP;</span><br></pre></td></tr></table></figure>
<hr>
<h1>View</h1>
<ul>
<li>View 是 <strong>虛擬資料表 (Virtual Table)</strong></li>
<li>由其他資料表（defining tables）查詢結果定義</li>
<li>View 本身 <strong>不實際存資料</strong></li>
<li>常見用途：
<ul>
<li>將複雜查詢包成 View 重複使用</li>
<li>隱藏欄位、做權限控管</li>
</ul>
</li>
</ul>
<blockquote>
<p>作者敢想 : 我感覺他很像Function 可以重複拿出來用</p>
</blockquote>
<h2 id="CREATE-VIEW-語法">CREATE VIEW 語法</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> view_name (col1, col2, ...)</span><br><span class="line"><span class="keyword">AS</span> <span class="keyword">SELECT</span> ...</span><br></pre></td></tr></table></figure>
<ul>
<li>定義 View 名稱 + 查詢內容</li>
<li>範例：計算每筆交易總金額</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> Transaction_total(tNo, totalAmount)</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> tNo, <span class="built_in">SUM</span>(salePrice)</span><br><span class="line"><span class="keyword">FROM</span> Record</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> tNo;</span><br></pre></td></tr></table></figure>
<h2 id="欄位命名方式差異">欄位命名方式差異</h2>
<ul>
<li>V1：View 欄位沿用原資料表欄位名稱</li>
<li>V2：在 CREATE VIEW 時 <strong>重新指定欄位名稱</strong></li>
<li>常用在：聚合結果、報表型 View</li>
</ul>
<h2 id="使用與刪除-View">使用與刪除 View</h2>
<ul>
<li>View 可直接用在 <code>FROM</code>，像一般資料表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Fname, Lname</span><br><span class="line"><span class="keyword">FROM</span> WORKS_ON1</span><br><span class="line"><span class="keyword">WHERE</span> Pname <span class="operator">=</span> <span class="string">&#x27;Seena&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>View 永遠是 <strong>即時資料（up-to-date）</strong></li>
<li>刪除 View：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> WORKS_ON1;</span><br></pre></td></tr></table></figure>
<h2 id="透過-View-修改資料（可更新-View）">透過 View 修改資料（可更新 View）</h2>
<ul>
<li>若 View 對應 <strong>單一資料表</strong></li>
<li>且修改有明確對應關係<br>
→ 更新 View = 更新原資料表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> Cheap_product</span><br><span class="line"><span class="keyword">SET</span> unitPrice <span class="operator">=</span> unitPrice <span class="operator">*</span> <span class="number">0.9</span>;</span><br></pre></td></tr></table></figure>
<p>➡ 實際修改的是 <code>Product</code></p>
<h2 id="不能更新的-View（三大類）">不能更新的 View（三大類）</h2>
<p>以下 View <strong>不可更新</strong>：</p>
<ol>
<li>View 定義中包含 <strong>聚合函數（SUM / AVG / COUNT）</strong></li>
<li>View 不包含 <strong>key（無法唯一對應一筆資料）</strong></li>
<li>View 由 <strong>多個資料表 JOIN</strong> 而成</li>
</ol>
<h2 id="更新的問題">更新的問題</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> Trans_product <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> tNo, pName</span><br><span class="line"><span class="keyword">FROM</span> Record <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> Product;</span><br></pre></td></tr></table></figure>
<ul>
<li>嘗試 UPDATE View 時</li>
<li>DBMS 無法判斷要更新哪個 base table</li>
<li>因此通常禁止</li>
</ul>
<h2 id="等價的正確更新方式">等價的正確更新方式</h2>
<ul>
<li>View 更新不被允許</li>
<li>但可直接更新 base tables</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> Product</span><br><span class="line"><span class="keyword">SET</span> pName <span class="operator">=</span> <span class="string">&#x27;OLAP進階&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> pNo <span class="operator">=</span> <span class="string">&#x27;b30999&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> Record</span><br><span class="line"><span class="keyword">SET</span> pNo <span class="operator">=</span> <span class="string">&#x27;b20666&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> tNo <span class="operator">=</span> <span class="string">&#x27;91100&#x27;</span> <span class="keyword">AND</span> pNo <span class="operator">=</span> <span class="string">&#x27;b30999&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h2 id="View-作為權限機制">View 作為權限機制</h2>
<ul>
<li>View 可限制使用者能看到的資料</li>
<li>常搭配 GRANT / REVOKE</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> DEPT5EMP <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> EMPLOYEE</span><br><span class="line"><span class="keyword">WHERE</span> Dno <span class="operator">=</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>
<p>➡ 使用者只能看到部門 5 的員工</p>
<h2 id="Schema-Change（結構演進）">Schema Change（結構演進）</h2>
<ul>
<li>Schema evolution：在系統運作中修改結構</li>
<li>不需重編整個資料庫</li>
<li>常見如：
<ul>
<li>ALTER TABLE</li>
<li>ADD / DROP 欄位</li>
</ul>
</li>
</ul>
<hr>
<h1>DROP Command 在做什麼</h1>
<p><strong>目的：刪除 schema 元素</strong></p>
<ul>
<li>可刪除：schema、table、view、domain、constraint</li>
<li>兩種行為：
<ul>
<li><code>CASCADE</code>：連同相依物件一起刪</li>
<li><code>RESTRICT</code>：若有相依物件就拒絕</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> SCHEMA COMPANY CASCADE;</span><br></pre></td></tr></table></figure>
<p>➡ schema 及其 tables / views / constraints 全部消失</p>
<h2 id="ALTER-TABLE-Command-在做什麼">ALTER TABLE Command 在做什麼</h2>
<p><strong>目的：在資料庫運作中修改表格結構</strong></p>
<ul>
<li>可做的事：
<ul>
<li>新增 / 刪除欄位</li>
<li>修改欄位定義</li>
<li>新增 / 刪除 constraint</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> COMPANY.EMPLOYEE</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">COLUMN</span> Job <span class="type">VARCHAR</span>(<span class="number">12</span>);</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="新增與刪除-Constraints">新增與刪除 Constraints</h2>
<p><strong>目的：動態管理約束</strong></p>
<ul>
<li>可針對「具名 constraint」操作</li>
<li>常見於 foreign key / check</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> COMPANY.EMPLOYEE</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> EMPSUPERFK CASCADE;</span><br></pre></td></tr></table></figure>
<h2 id="刪除欄位與-Default-值">刪除欄位與 Default 值</h2>
<h3 id="刪除欄位">刪除欄位</h3>
<ul>
<li>必須指定：<code>CASCADE</code> 或 <code>RESTRICT</code></li>
<li>若有 view 參考該欄位：
<ul>
<li>CASCADE：連 view 一起刪</li>
<li>RESTRICT：禁止</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> COMPANY.EMPLOYEE</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">COLUMN</span> Address CASCADE;</span><br></pre></td></tr></table></figure>
<h3 id="修改-Default-值">修改 Default 值</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> COMPANY.DEPARTMENT</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> Mgr_ssn <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER TABLE</span> COMPANY.DEPARTMENT</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> Mgr_ssn <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;333445555&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h2 id="SQL-語法總覽">SQL 語法總覽</h2>
<p><strong>目的：當作語法查表</strong></p>
<ul>
<li>CREATE / DROP / ALTER TABLE</li>
<li>SELECT（含 JOIN / GROUP BY / HAVING / ORDER BY）</li>
<li>INSERT / DELETE / UPDATE</li>
<li>CREATE / DROP VIEW</li>
<li>CREATE / DROP INDEX（非標準 SQL）</li>
</ul>
<h2 id="DBMS-差異補充（很愛考觀念）">DBMS 差異補充（很愛考觀念）</h2>
<ul>
<li>有些 DBMS：
<ul>
<li>用 <code>MINUS</code> 取代 <code>EXCEPT</code></li>
<li>不支援 <code>CREATE ASSERTION</code></li>
<li>用 <code>CREATE TRIGGER</code> 模擬 assertion</li>
<li>不支援 <code>NATURAL JOIN</code></li>
<li>對 JOIN View 的更新限制較寬鬆</li>
</ul>
</li>
</ul>
<hr>
<blockquote>
<p>先這樣</p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://YowDesert.github.io">YowDesert</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章連結: </span><span class="post-copyright-info"><a href="https://yowdesert.github.io/posts/31704117.html">https://yowdesert.github.io/posts/31704117.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版權聲明: </span><span class="post-copyright-info">本部落格所有文章除特別聲明外，均採用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 授權協議。轉載請註明來源 <a href="https://YowDesert.github.io" target="_blank">YD's 資訊學習筆記</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%B3%87%E6%96%99%E5%BA%AB%E7%B3%BB%E7%B5%B1/">資料庫系統</a><a class="post-meta__tags" href="/tags/SQL/">SQL</a></div><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/posts/67c68839.html" title="(作業系統) Deadlock Definition, Avoidance and Resolution"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">(作業系統) Deadlock Definition, Avoidance and Resolution</div></div><div class="info-2"><div class="info-item-1">Deadlock基本概念 1. Deadlock 是什麼？ Deadlock 指的是：  一組 processes 彼此等待對方所持有的資源，導致所有 process 都無法繼續執行。  Deadlock 的特徵  每個 process：  已持有至少一個資源 同時等待另一個 process 持有的資源   結果：大家互等，系統停住   2. Deadlock 範例 Example 1：兩個 processes、兩個資源  P1 持有 R1，等待 R2 P2 持有 R2，等待 R1 → 互相等待，發生 deadlock  Example 2：Semaphore A 與 B 12P1: wait(A); wait(B); ...; signal(B); signal(A);P2: wait(B); wait(A); ...; signal(A); signal(B);  若 P1 先拿到 A、P2 先拿到 B 下一步彼此都在等對方 → deadlock   Deadlock 的四個必要條件 Deadlock 當且僅當下列四個條件同時成立：  Mutual Exclusion（互斥）...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相關推薦</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/4f5b5fb4.html" title="(資料庫系統) Basic SQL (Structured Query Language)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-09</div><div class="info-item-2">(資料庫系統) Basic SQL (Structured Query Language)</div></div><div class="info-2"><div class="info-item-1">簡短說明：  主題：Basic SQL 本章重點：  SQL 的由來與「關聯模型」差異 SQL 三種語言：DDL / DML / DCL Schema / Catalog / CREATE TABLE 資料型態 &amp; Domain 各種 Constraints（PK / FK / UNIQUE / NOT NULL / CHECK / DEFAULT） 基本查詢：SELECT-FROM-WHERE、DISTINCT、集合運算 INSERT / DELETE / UPDATE 修改資料     Basic SQL &amp; 關聯模型差異 SQL的由來   起源：從 tuple calculus（關聯謂詞演算）發展出語言 SQUARE → SEQUEL → SQL   SQL 原本是 SEQUEL to SQUARE 的縮寫，後來因版權改成 SQL（Structured Query Language） → 目前都習慣叫「Structured Query Language」。   名詞對照（數學 vs 實作） 理論的關聯模型使用比較「數學」的名稱：    關聯模型 SQL 實務...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">YowDesert</div><div class="author-info-description">這是YowDesert的部落格，記錄學習資訊工程領域的過程和心得，並以簡單白話的方式呈現，一起和我踏入資訊世界吧，有興趣的話歡迎Follow我歐。</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">標籤</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分類</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/yowdesert"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/yowdesert" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:csaidesert@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目錄</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">CH07 Advanced SQL（More SQL）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">More Complex SQL Retrieval Queries</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">NULL 與 Three-Valued Logic（三值邏輯）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NULL-%E7%9A%84%E6%84%8F%E7%BE%A9"><span class="toc-number">3.1.</span> <span class="toc-text">NULL 的意義</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E8%A6%81%E8%A7%80%E5%BF%B5"><span class="toc-number">3.2.</span> <span class="toc-text">重要觀念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Three-Valued-Logic%EF%BC%88%E4%B8%89%E5%80%BC%E9%82%8F%E8%BC%AF%EF%BC%89"><span class="toc-number">3.3.</span> <span class="toc-text">Three-Valued Logic（三值邏輯）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AND%EF%BC%88%E4%B8%94%EF%BC%89"><span class="toc-number">3.3.1.</span> <span class="toc-text">AND（且）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OR%EF%BC%88%E6%88%96%EF%BC%89"><span class="toc-number">3.3.2.</span> <span class="toc-text">OR（或）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NOT%EF%BC%88%E9%9D%9E%EF%BC%89"><span class="toc-number">3.3.3.</span> <span class="toc-text">NOT（非）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">檢查 NULL：IS NULL &#x2F; IS NOT NULL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">Nested Queries（巢狀查詢）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E9%BA%BC%E6%98%AF-Nested-Query%EF%BC%88%E5%B7%A2%E7%8B%80%E6%9F%A5%E8%A9%A2%EF%BC%89"><span class="toc-number">5.1.</span> <span class="toc-text">什麼是 Nested Query（巢狀查詢）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E7%BE%A9"><span class="toc-number">5.1.1.</span> <span class="toc-text">定義</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IN-%E9%81%8B%E7%AE%97%E5%AD%90%EF%BC%88%E6%9C%80%E5%9F%BA%E6%9C%AC%E3%80%81%E6%9C%80%E5%B8%B8%E8%80%83%EF%BC%89"><span class="toc-number">5.2.</span> <span class="toc-text">IN 運算子（最基本、最常考）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B"><span class="toc-number">5.2.1.</span> <span class="toc-text">範例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Tuple%EF%BC%88%E5%A4%9A%E6%AC%84%E4%BD%8D%EF%BC%89%E5%81%9A%E6%AF%94%E8%BC%83"><span class="toc-number">5.3.</span> <span class="toc-text">使用 Tuple（多欄位）做比較</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Example"><span class="toc-number">5.3.1.</span> <span class="toc-text">Example</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IN-%E5%8F%B3%E9%82%8A%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E5%AF%AB%E5%B8%B8%E6%95%B8%E9%9B%86%E5%90%88"><span class="toc-number">5.4.</span> <span class="toc-text">IN 右邊可以直接寫常數集合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%A9%A2%E5%8F%AF%E4%BB%A5%E5%8F%83%E8%80%83%E5%A4%96%E5%B1%A4%E6%9F%A5%E8%A9%A2"><span class="toc-number">5.5.</span> <span class="toc-text">子查詢可以參考外層查詢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EXAMPLE"><span class="toc-number">5.5.1.</span> <span class="toc-text">EXAMPLE</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">集合比較運算子</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ANY%EF%BC%88%E6%88%96-SOME%EF%BC%89%E9%81%8B%E7%AE%97%E5%AD%90"><span class="toc-number">6.1.</span> <span class="toc-text">ANY（或 SOME）運算子</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AA%9E%E6%B3%95"><span class="toc-number">6.1.1.</span> <span class="toc-text">語法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AA%AA%E6%98%8E"><span class="toc-number">6.1.2.</span> <span class="toc-text">說明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ALL-%E9%81%8B%E7%AE%97%E5%AD%90%EF%BC%88%E9%9D%9E%E5%B8%B8%E9%87%8D%E8%A6%81%EF%BC%89"><span class="toc-number">6.2.</span> <span class="toc-text">ALL 運算子（非常重要）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AA%9E%E6%B3%95-2"><span class="toc-number">6.2.1.</span> <span class="toc-text">語法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AA%AA%E6%98%8E-2"><span class="toc-number">6.2.2.</span> <span class="toc-text">說明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B-1%EF%BC%9A%E8%96%AA%E8%B3%87%E6%AF%94%E8%BC%83"><span class="toc-number">6.2.3.</span> <span class="toc-text">範例 1：薪資比較</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B-2%EF%BC%9A%E5%95%86%E5%93%81%E5%83%B9%E6%A0%BC"><span class="toc-number">6.2.4.</span> <span class="toc-text">範例 2：商品價格</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AF%94%E8%BC%83%E9%81%8B%E7%AE%97%E5%AD%90%E5%8F%AF%E6%90%AD%E9%85%8D-ANY-ALL"><span class="toc-number">6.3.</span> <span class="toc-text">比較運算子可搭配 ANY &#x2F; ALL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Alias-%E9%81%BF%E5%85%8D%E6%A8%A1%E7%B3%8A%E9%8C%AF%E8%AA%A4"><span class="toc-number">6.4.</span> <span class="toc-text">使用 Alias 避免模糊錯誤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%BA%E4%BB%80%E9%BA%BC%E9%9C%80%E8%A6%81-Alias%EF%BC%9F"><span class="toc-number">6.4.1.</span> <span class="toc-text">為什麼需要 Alias？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B%EF%BC%88Query-16%EF%BC%89"><span class="toc-number">6.4.2.</span> <span class="toc-text">範例（Query 16）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">Correlated Nested Queries（相關巢狀查詢）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E7%BE%A9-2"><span class="toc-number">7.1.</span> <span class="toc-text">定義</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%80%A7"><span class="toc-number">7.2.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%B9%E5%AF%AB%E7%82%BA%E5%96%AE%E4%B8%80%E6%9F%A5%E8%A9%A2%EF%BC%88JOIN%EF%BC%89"><span class="toc-number">7.3.</span> <span class="toc-text">改寫為單一查詢（JOIN）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">8.</span> <span class="toc-text">EXISTS 函數</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AA%9E%E6%B3%95-3"><span class="toc-number">8.1.</span> <span class="toc-text">語法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AA%AA%E6%98%8E-3"><span class="toc-number">8.2.</span> <span class="toc-text">說明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B%EF%BC%9A%E6%89%BE%E5%87%BA%E6%9C%89%E8%B3%BC%E8%B2%B7%E6%8C%87%E5%AE%9A%E5%95%86%E5%93%81%E7%9A%84%E6%9C%83%E5%93%A1"><span class="toc-number">8.2.1.</span> <span class="toc-text">範例：找出有購買指定商品的會員</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EXISTS-EXISTS%EF%BC%88%E8%A4%87%E5%90%88%E6%A2%9D%E4%BB%B6%EF%BC%89"><span class="toc-number">8.3.</span> <span class="toc-text">EXISTS + EXISTS（複合條件）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B%EF%BC%9A%E6%89%BE%E5%87%BA%E3%80%8C%E8%87%B3%E5%B0%91%E6%9C%89%E4%B8%80%E4%BD%8D%E5%AE%B6%E5%B1%AC%E7%9A%84%E4%B8%BB%E7%AE%A1%E3%80%8D"><span class="toc-number">8.3.1.</span> <span class="toc-text">範例：找出「至少有一位家屬的主管」</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">9.</span> <span class="toc-text">NOT EXISTS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AA%9E%E6%B3%95-4"><span class="toc-number">9.1.</span> <span class="toc-text">語法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AA%AA%E6%98%8E-4"><span class="toc-number">9.2.</span> <span class="toc-text">說明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B%EF%BC%9A%E6%89%BE%E5%87%BA%E4%B8%8D%E6%98%AF%E7%94%B1%E8%B3%BC%E7%89%A9%E8%BB%8A%E7%94%A2%E7%94%9F%E7%9A%84%E4%BA%A4%E6%98%93"><span class="toc-number">9.2.1.</span> <span class="toc-text">範例：找出不是由購物車產生的交易</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E9%BB%9E%E6%95%B4%E7%90%86"><span class="toc-number">9.3.</span> <span class="toc-text">重點整理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">10.</span> <span class="toc-text">JOINed Tables</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E8%A7%80%E5%BF%B5%EF%BC%9AJOIN-%E6%98%AF%E5%9C%A8-FROM-%E5%85%88%E5%81%9A%E3%80%81WHERE-%E5%86%8D%E9%81%8E%E6%BF%BE"><span class="toc-number">10.1.</span> <span class="toc-text">核心觀念：JOIN 是在 FROM 先做、WHERE 再過濾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Joined-table%EF%BC%88%E5%9C%A8-FROM-%E7%9B%B4%E6%8E%A5%E6%8C%87%E5%AE%9A-JOIN-%E5%87%BA%E4%BE%86%E7%9A%84%E8%A1%A8%EF%BC%89"><span class="toc-number">10.2.</span> <span class="toc-text">Joined table（在 FROM 直接指定 JOIN 出來的表）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E7%BE%A9-3"><span class="toc-number">10.2.1.</span> <span class="toc-text">定義</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B-2"><span class="toc-number">10.2.2.</span> <span class="toc-text">範例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JOIN-%E7%9A%84%E7%A8%AE%E9%A1%9E%E7%B8%BD%E8%A6%BD"><span class="toc-number">10.3.</span> <span class="toc-text">JOIN 的種類總覽</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NATURAL-JOIN"><span class="toc-number">10.3.1.</span> <span class="toc-text">NATURAL JOIN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OUTER-JOIN%EF%BC%88LEFT-RIGHT-FULL%EF%BC%89"><span class="toc-number">10.3.2.</span> <span class="toc-text">OUTER JOIN（LEFT &#x2F; RIGHT &#x2F; FULL）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NATURAL-JOIN%EF%BC%88%E8%87%AA%E7%84%B6%E9%80%A3%E6%8E%A5%EF%BC%89"><span class="toc-number">10.4.</span> <span class="toc-text">NATURAL JOIN（自然連接）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">10.4.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%BA%E4%BA%86-NATURAL-JOIN%EF%BC%8C%E5%B8%B8%E9%9C%80%E8%A6%81%E5%85%88%E3%80%8C%E6%94%B9%E6%AC%84%E4%BD%8D%E5%90%8D%E3%80%8D"><span class="toc-number">10.4.2.</span> <span class="toc-text">為了 NATURAL JOIN，常需要先「改欄位名」</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#INNER-JOIN-vs-OUTER-JOIN"><span class="toc-number">10.5.</span> <span class="toc-text">INNER JOIN vs OUTER JOIN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#INNER-JOIN%EF%BC%88%E5%85%A7%E9%80%A3%E6%8E%A5%EF%BC%89"><span class="toc-number">10.5.1.</span> <span class="toc-text">INNER JOIN（內連接）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LEFT-OUTER-JOIN%EF%BC%88%E5%B7%A6%E5%A4%96%E9%80%A3%E6%8E%A5%EF%BC%89"><span class="toc-number">10.5.2.</span> <span class="toc-text">LEFT OUTER JOIN（左外連接）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RIGHT-OUTER-JOIN%EF%BC%88%E5%8F%B3%E5%A4%96%E9%80%A3%E6%8E%A5%EF%BC%89"><span class="toc-number">10.5.3.</span> <span class="toc-text">RIGHT OUTER JOIN（右外連接）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LEFT-OUTER-JOIN-%E7%AF%84%E4%BE%8B%EF%BC%88%E5%93%A1%E5%B7%A5%E8%88%87%E4%B8%BB%E7%AE%A1%EF%BC%89"><span class="toc-number">10.6.</span> <span class="toc-text">LEFT OUTER JOIN 範例（員工與主管）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82"><span class="toc-number">10.6.1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%88%8A%E5%BC%8F%E8%AA%9E%E6%B3%95%EF%BC%88%E4%BA%86%E8%A7%A3%E5%8D%B3%E5%8F%AF%EF%BC%89"><span class="toc-number">10.6.2.</span> <span class="toc-text">舊式語法（了解即可）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Multiway-JOIN%EF%BC%88%E5%A4%9A%E8%A1%A8-JOIN%EF%BC%89"><span class="toc-number">10.7.</span> <span class="toc-text">Multiway JOIN（多表 JOIN）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5-2"><span class="toc-number">10.7.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B%EF%BC%88Q2A%EF%BC%89"><span class="toc-number">10.7.2.</span> <span class="toc-text">範例（Q2A）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OUTER-JOIN-%E7%9A%84%E3%80%8C%E8%B6%85%E7%B4%9A%E9%99%B7%E9%98%B1%E3%80%8D%EF%BC%9A%E6%A2%9D%E4%BB%B6%E6%94%BE-WHERE-%E6%9C%83%E8%AE%93-OUTER-JOIN-%E5%A4%B1%E6%95%88"><span class="toc-number">10.8.</span> <span class="toc-text">OUTER JOIN 的「超級陷阱」：條件放 WHERE 會讓 OUTER JOIN 失效</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%8C%E7%9B%AE%E9%9C%80%E6%B1%82"><span class="toc-number">10.8.1.</span> <span class="toc-text">題目需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%8C%AF%E8%AA%A4%E5%AF%AB%E6%B3%95%EF%BC%88WRONG%EF%BC%89"><span class="toc-number">10.8.2.</span> <span class="toc-text">錯誤寫法（WRONG）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E7%A2%BA%E5%AF%AB%E6%B3%95%EF%BC%88%E6%8A%8A%E6%A2%9D%E4%BB%B6%E6%94%BE-ON%EF%BC%89"><span class="toc-number">10.8.3.</span> <span class="toc-text">正確寫法（把條件放 ON）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E9%BA%BC%E6%99%82%E5%80%99%E6%94%BE-ON%EF%BC%9F%E4%BB%80%E9%BA%BC%E6%99%82%E5%80%99%E6%94%BE-WHERE%EF%BC%9F"><span class="toc-number">10.9.</span> <span class="toc-text">什麼時候放 ON？什麼時候放 WHERE？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JOIN%E6%95%B4%E7%90%86"><span class="toc-number">10.10.</span> <span class="toc-text">JOIN整理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">11.</span> <span class="toc-text">Aggregate Functions &amp; GROUP BY &#x2F; HAVING</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Aggregate-Functions%EF%BC%88%E5%BD%99%E7%B8%BD%E5%87%BD%E6%95%B8%EF%BC%89"><span class="toc-number">11.1.</span> <span class="toc-text">Aggregate Functions（彙總函數）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NULL-%E8%88%87-aggregate"><span class="toc-number">11.1.1.</span> <span class="toc-text">NULL 與 aggregate</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Aggregation-%E7%B5%90%E6%9E%9C%E6%94%B9%E6%AC%84%E4%BD%8D%E5%90%8D%E3%80%81%E5%8F%96%E5%88%A5%E5%90%8D%EF%BC%88AS%EF%BC%89"><span class="toc-number">11.2.</span> <span class="toc-text">Aggregation 結果改欄位名、取別名（AS）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">11.2.1.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Aggregation-WHERE%EF%BC%88%E5%85%88%E7%AF%A9%E9%81%B8%EF%BC%8C%E5%86%8D%E5%BD%99%E7%B8%BD%EF%BC%89"><span class="toc-number">11.3.</span> <span class="toc-text">Aggregation + WHERE（先篩選，再彙總）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B-3"><span class="toc-number">11.3.1.</span> <span class="toc-text">範例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#COUNT-%E7%AF%84%E4%BE%8B"><span class="toc-number">11.3.2.</span> <span class="toc-text">COUNT 範例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SOME-ALL-%E4%B9%9F%E5%8F%AF%E7%95%B6%E3%80%8C%E5%B8%83%E6%9E%97%E9%9B%86%E5%90%88%E5%87%BD%E6%95%B8%E3%80%8D"><span class="toc-number">11.4.</span> <span class="toc-text">SOME &#x2F; ALL 也可當「布林集合函數」</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GROUP-BY%EF%BC%88%E5%88%86%E7%B5%84%EF%BC%89"><span class="toc-number">11.5.</span> <span class="toc-text">GROUP BY（分組）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%8F%E5%89%87%EF%BC%88%E5%BF%85%E8%83%8C%EF%BC%89"><span class="toc-number">11.5.1.</span> <span class="toc-text">規則（必背）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B%EF%BC%88Q24%EF%BC%9A%E6%AF%8F%E5%80%8B%E9%83%A8%E9%96%80%E7%9A%84%E5%93%A1%E5%B7%A5%E6%95%B8%E8%88%87%E5%B9%B3%E5%9D%87%E8%96%AA%E8%B3%87%EF%BC%89"><span class="toc-number">11.5.2.</span> <span class="toc-text">範例（Q24：每個部門的員工數與平均薪資）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NULL-%E5%88%86%E7%B5%84"><span class="toc-number">11.5.3.</span> <span class="toc-text">NULL 分組</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GROUP-BY-%E5%A5%97%E5%9C%A8-JOIN-%E7%B5%90%E6%9E%9C%E4%B8%8A"><span class="toc-number">11.6.</span> <span class="toc-text">GROUP BY 套在 JOIN 結果上</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B%EF%BC%88Q25%EF%BC%9A%E6%AF%8F%E5%80%8B%E5%B0%88%E6%A1%88%E6%9C%89%E5%A4%9A%E5%B0%91%E5%93%A1%E5%B7%A5%E5%8F%83%E8%88%87%EF%BC%89"><span class="toc-number">11.6.1.</span> <span class="toc-text">範例（Q25：每個專案有多少員工參與）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HAVING%EF%BC%88%E7%AF%A9%E9%81%B8%E3%80%8C%E6%95%B4%E7%B5%84%E3%80%8D%EF%BC%89"><span class="toc-number">11.7.</span> <span class="toc-text">HAVING（篩選「整組」）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B%EF%BC%88Q26%EF%BC%9A%E5%8F%83%E8%88%87%E4%BA%BA%E6%95%B8-2-%E7%9A%84%E5%B0%88%E6%A1%88%EF%BC%89"><span class="toc-number">11.7.1.</span> <span class="toc-text">範例（Q26：參與人數 &gt; 2 的專案）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WHERE-HAVING-%E7%9A%84%E5%B8%B8%E8%A6%8B%E9%8C%AF%E8%AA%A4%E8%88%87%E6%AD%A3%E7%A2%BA%E5%AF%AB%E6%B3%95"><span class="toc-number">11.8.</span> <span class="toc-text">WHERE + HAVING 的常見錯誤與正確寫法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%8C%AF%E8%AA%A4%EF%BC%88%E6%9C%83%E6%8A%8A%E9%83%A8%E9%96%80%E7%B8%BD%E4%BA%BA%E6%95%B8%E4%B9%9F%E9%99%90%E5%88%B6%E6%88%90%E8%96%AA%E8%B3%87-40000-%E7%9A%84%E4%BA%BA%E6%95%B8%EF%BC%89"><span class="toc-number">11.8.1.</span> <span class="toc-text">錯誤（會把部門總人數也限制成薪資 &gt; 40000 的人數）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E7%A2%BA%EF%BC%88%E5%85%88%E9%81%B8%E5%87%BA%E3%80%8C%E7%B8%BD%E5%93%A1%E5%B7%A5%E6%95%B8-5%E3%80%8D%E7%9A%84%E9%83%A8%E9%96%80%EF%BC%8C%E5%86%8D%E7%B5%B1%E8%A8%88%E8%A9%B2%E9%83%A8%E9%96%80%E7%9A%84%E9%AB%98%E8%96%AA%E5%93%A1%E5%B7%A5%E6%95%B8%EF%BC%89"><span class="toc-number">11.8.2.</span> <span class="toc-text">正確（先選出「總員工數 &gt; 5」的部門，再統計該部門的高薪員工數）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%B0%8D%E7%85%A7"><span class="toc-number">11.9.</span> <span class="toc-text">快速對照</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">12.</span> <span class="toc-text">WITH Clause（CTE</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WITH-%E7%AF%84%E4%BE%8B%EF%BC%88%E6%94%B9%E5%AF%AB%E5%AD%90%E6%9F%A5%E8%A9%A2"><span class="toc-number">12.1.</span> <span class="toc-text">WITH 範例（改寫子查詢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CASE%EF%BC%88%E6%A2%9D%E4%BB%B6%E8%A1%A8%E9%81%94%E5%BC%8F%EF%BC%89"><span class="toc-number">12.2.</span> <span class="toc-text">CASE（條件表達式）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Recursive-Queries-%E6%A6%82%E5%BF%B5"><span class="toc-number">12.3.</span> <span class="toc-text">Recursive Queries 概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Recursive-CTE-%E7%AF%84%E4%BE%8B"><span class="toc-number">12.4.</span> <span class="toc-text">Recursive CTE 範例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL-%E6%9F%A5%E8%A9%A2%E5%AE%8C%E6%95%B4%E7%B5%90%E6%A7%8B"><span class="toc-number">12.5.</span> <span class="toc-text">SQL 查詢完整結構</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-ASSERTION%EF%BC%88%E8%AA%9E%E6%84%8F%E7%B4%84%E6%9D%9F"><span class="toc-number">12.6.</span> <span class="toc-text">7. ASSERTION（語意約束</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-TRIGGER"><span class="toc-number">12.7.</span> <span class="toc-text">8. TRIGGER</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-Recursive-Queries"><span class="toc-number">12.8.</span> <span class="toc-text">13. Recursive Queries</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">13.</span> <span class="toc-text">View</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CREATE-VIEW-%E8%AA%9E%E6%B3%95"><span class="toc-number">13.1.</span> <span class="toc-text">CREATE VIEW 語法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AC%84%E4%BD%8D%E5%91%BD%E5%90%8D%E6%96%B9%E5%BC%8F%E5%B7%AE%E7%95%B0"><span class="toc-number">13.2.</span> <span class="toc-text">欄位命名方式差異</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%88%87%E5%88%AA%E9%99%A4-View"><span class="toc-number">13.3.</span> <span class="toc-text">使用與刪除 View</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%8F%E9%81%8E-View-%E4%BF%AE%E6%94%B9%E8%B3%87%E6%96%99%EF%BC%88%E5%8F%AF%E6%9B%B4%E6%96%B0-View%EF%BC%89"><span class="toc-number">13.4.</span> <span class="toc-text">透過 View 修改資料（可更新 View）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E8%83%BD%E6%9B%B4%E6%96%B0%E7%9A%84-View%EF%BC%88%E4%B8%89%E5%A4%A7%E9%A1%9E%EF%BC%89"><span class="toc-number">13.5.</span> <span class="toc-text">不能更新的 View（三大類）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E7%9A%84%E5%95%8F%E9%A1%8C"><span class="toc-number">13.6.</span> <span class="toc-text">更新的問題</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%89%E5%83%B9%E7%9A%84%E6%AD%A3%E7%A2%BA%E6%9B%B4%E6%96%B0%E6%96%B9%E5%BC%8F"><span class="toc-number">13.7.</span> <span class="toc-text">等價的正確更新方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#View-%E4%BD%9C%E7%82%BA%E6%AC%8A%E9%99%90%E6%A9%9F%E5%88%B6"><span class="toc-number">13.8.</span> <span class="toc-text">View 作為權限機制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Schema-Change%EF%BC%88%E7%B5%90%E6%A7%8B%E6%BC%94%E9%80%B2%EF%BC%89"><span class="toc-number">13.9.</span> <span class="toc-text">Schema Change（結構演進）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">14.</span> <span class="toc-text">DROP Command 在做什麼</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ALTER-TABLE-Command-%E5%9C%A8%E5%81%9A%E4%BB%80%E9%BA%BC"><span class="toc-number">14.1.</span> <span class="toc-text">ALTER TABLE Command 在做什麼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E8%88%87%E5%88%AA%E9%99%A4-Constraints"><span class="toc-number">14.2.</span> <span class="toc-text">新增與刪除 Constraints</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%AA%E9%99%A4%E6%AC%84%E4%BD%8D%E8%88%87-Default-%E5%80%BC"><span class="toc-number">14.3.</span> <span class="toc-text">刪除欄位與 Default 值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%AA%E9%99%A4%E6%AC%84%E4%BD%8D"><span class="toc-number">14.3.1.</span> <span class="toc-text">刪除欄位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-Default-%E5%80%BC"><span class="toc-number">14.3.2.</span> <span class="toc-text">修改 Default 值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL-%E8%AA%9E%E6%B3%95%E7%B8%BD%E8%A6%BD"><span class="toc-number">14.4.</span> <span class="toc-text">SQL 語法總覽</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DBMS-%E5%B7%AE%E7%95%B0%E8%A3%9C%E5%85%85%EF%BC%88%E5%BE%88%E6%84%9B%E8%80%83%E8%A7%80%E5%BF%B5%EF%BC%89"><span class="toc-number">14.5.</span> <span class="toc-text">DBMS 差異補充（很愛考觀念）</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/31704117.html" title="(資料庫系統) Advanced SQL">(資料庫系統) Advanced SQL</a><time datetime="2025-12-14T07:00:00.000Z" title="發表於 2025-12-14 15:00:00">2025-12-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/67c68839.html" title="(作業系統) Deadlock Definition, Avoidance and Resolution">(作業系統) Deadlock Definition, Avoidance and Resolution</a><time datetime="2025-12-13T08:12:16.201Z" title="發表於 2025-12-13 16:12:16">2025-12-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/4f5b5fb4.html" title="(資料庫系統) Basic SQL (Structured Query Language)">(資料庫系統) Basic SQL (Structured Query Language)</a><time datetime="2025-12-09T13:16:17.006Z" title="發表於 2025-12-09 21:16:17">2025-12-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/52554cd4.html" title="(線性代數) 矩陣與矩陣運算">(線性代數) 矩陣與矩陣運算</a><time datetime="2025-08-14T00:40:00.000Z" title="發表於 2025-08-14 08:40:00">2025-08-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/90aa57da.html" title="(作業系統) Process and Concurrency - Synchronization Concepts">(作業系統) Process and Concurrency - Synchronization Concepts</a><time datetime="2025-08-14T00:40:00.000Z" title="發表於 2025-08-14 08:40:00">2025-08-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/nav_Picture.jpg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By YowDesert</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主題 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="閱讀模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日夜模式切換"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="單欄和雙欄切換"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="設定"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目錄"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到頂端"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.4/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        loader: {
          load: [
            // Four font extension packages (optional)
            //- '[tex]/bbm',
            //- '[tex]/bboldx',
            //- '[tex]/dsfont',
            '[tex]/mhchem'
          ],
          paths: {
            'mathjax-newcm': '[mathjax]/../@mathjax/mathjax-newcm-font',

            //- // Four font extension packages (optional)
            //- 'mathjax-bbm-extension': '[mathjax]/../@mathjax/mathjax-bbm-font-extension',
            //- 'mathjax-bboldx-extension': '[mathjax]/../@mathjax/mathjax-bboldx-font-extension',
            //- 'mathjax-dsfont-extension': '[mathjax]/../@mathjax/mathjax-dsfont-font-extension',
            'mathjax-mhchem-extension': '[mathjax]/../@mathjax/mathjax-mhchem-font-extension'
          }
        },
        output: {
          font: 'mathjax-newcm',
        },
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
          packages: {
            '[+]': [
              'mhchem'
            ]
          }
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          menuOptions: {
            settings: {
              enrich: false  // Turn off Braille and voice narration text automatic generation
            }
          },
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax@4.0.0/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script></div><script async data-pjax src="/"></script></div></body></html>